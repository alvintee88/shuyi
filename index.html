<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShuYi DOB Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
			display: flex; /* Make the container a flex container */
			align-items: center; /* Vertically align items in the middle */
            gap: 10px; /* Add space between items */
            margin-bottom: 20px;
        }
        label, input, button {
            margin-bottom: 10px;
            display: block;
        }
    /* --- New Table Styles --- */
        #results table {
            width: 100%;
            border-collapse: collapse; /* Removes space between table borders */
            margin-top: 10px;
        }
        #results th, #results td {
            border: 1px solid #ddd; /* Light border for cells */
            padding: 8px;
            text-align: left;
        }
        #results th {
            background-color: #f2f2f2; /* Light background for headers */
        }		
        canvas {
            border: 1px solid #000;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h2>数易文化联合数字计算法</h2>

    <div class="container">
        <label for="dob">出生日期</label>
        <input type="date" id="dob">
        <button onclick="calculateAndDraw()">提交</button>
    </div>

    <div id="results">
        <table>
            <thead>
                <tr>
                    <th>组别</th>
                    <th>数字</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>(1) 父基因</strong></td>
                    <td id="F1_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(2) 母基因</strong></td>
                    <td id="F2_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(3) 主性格</strong></td>
                    <td id="F3_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(4) 人生过程1</strong></td>
                    <td id="F4_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(5) 人生过程2</strong></td>
                    <td id="F5_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(6) 子女下属</strong></td>
                    <td id="F6_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(7) 事业过程1</strong></td>
                    <td id="F7_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(8) 事业过程2</strong></td>
                    <td id="F8_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(9) 当下朋友</strong></td>
                    <td id="F9_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(10) 婚姻过程1</strong></td>
                    <td id="F10_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(11) 婚姻过程2</strong></td>
                    <td id="F11_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(12) 晚年、健康、财富、子女</strong></td>
                    <td id="F12_Result"></td>
                </tr>		
                <tr>
                    <td><strong>(13) 隐藏号</strong></td>
                    <td id="F13_Result"></td>
                </tr>		
			</tbody>
        </table>
        <table>
			<tbody>
				<tr>
					<td><strong>A</strong></td>
					<td><strong>B</strong></td>
					<td><strong>C</strong></td>
					<td><strong>D</strong></td>
					<td><strong>E</strong></td>
					<td><strong>F</strong></td>
					<td><strong>G</strong></td>
					<td><strong>H</strong></td>
				</tr>		
				<tr>
					<td id="A_Result"></td>
					<td id="B_Result"></td>
					<td id="C_Result"></td>
					<td id="D_Result"></td>
					<td id="E_Result"></td>
					<td id="F_Result"></td>
					<td id="G_Result"></td>
					<td id="H_Result"></td>
				</tr>		
				<tr>
					<td><strong>I (A + B)</strong></td>
					<td><strong></strong></td>
					<td><strong>J (C + D)</strong></td>
					<td><strong></strong></td>
					<td><strong>K (E + F)</strong></td>
					<td><strong></strong></td>
					<td><strong>L (G + H)</strong></td>
					<td></td>
				</tr>		
				<tr>
					<td id="I_Result"></td>
					<td></td>
					<td id="J_Result"></td>
					<td></td>
					<td id="K_Result"></td>
					<td></td>
					<td id="L_Result"></td>
					<td></td>
				</tr>		
				<tr>
					<td><strong>M (I + J)</strong></td>
					<td><strong></strong></td>
					<td><strong></strong></td>
					<td><strong></strong></td>
					<td><strong>N (K + L)</strong></td>
					<td><strong></strong></td>
					<td></td>
					<td></td>
				</tr>		
				<tr>
					<td id="M_Result"></td>
					<td></td>
					<td></td>
					<td></td>
					<td id="N_Result"></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>		
				<tr>
					<td><strong>O (M + N)</strong></td>
				</tr>		
				<tr>
					<td id="O_Result"></td>
				</tr>		
			</tbody>
        </table>
		
        <p><strong>P (M + O):</strong> <span id="P_Result"></span></p>
        <p><strong>Q (N + O):</strong> <span id="Q_Result"></span></p>
        <p><strong>R (Q + P):</strong> <span id="R_Result"></span></p>
        <p><strong>S (J + M):</strong> <span id="S_Result"></span></p>
        <p><strong>T (I + M):</strong> <span id="T_Result"></span></p>
        <p><strong>U (T + S):</strong> <span id="U_Result"></span></p>
        <p><strong>V (K + N):</strong> <span id="V_Result"></span></p>
        <p><strong>W (L + N):</strong> <span id="W_Result"></span></p>
        <p><strong>X (V + W):</strong> <span id="X_Result"></span></p>
    </div>

    <canvas id="myCanvas" width="300" height="300"></canvas>

    <script>
        // Function to format date as YYYY-MM-DD
        function getTodayDateString() {
            const today = new Date();
            const year = today.getFullYear();
            let month = today.getMonth() + 1; // Months are 0-indexed
            let day = today.getDate();

            // Pad with leading zero if necessary
            if (month < 10) {
                month = '0' + month;
            }
            if (day < 10) {
                day = '0' + day;
            }
            //return `${year}-${month}-${day}`;
			return '1999-12-31'; 
        }

        // Set the default value when the page loads
        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('dob').value = getTodayDateString();
        });


        function calculateAndDraw() {
            const dobInput = document.getElementById('dob').value;

            if (!dobInput) {
                alert('Please select a date of birth.');
                return;
            }

            // Split the date for calculations (it comes as YYYY-MM-DD)
            const dateParts = dobInput.split('-'); // ["YYYY", "MM", "DD"]
            const year = dateParts[0];
            const month = dateParts[1];
            const day = dateParts[2];

            // Function to sum digits repeatedly until a single digit
            function sumDigits(numStr) {
                let sum = 0;
                // Ensure numStr is treated as a string for iteration
                const str = String(numStr);
                for (let i = 0; i < str.length; i++) {
                    sum += parseInt(str[i], 10); // Use radix 10 for parseInt
                }
                if (sum >= 10) {
                    return sumDigits(sum.toString());
                }
                return sum;
            }

            document.getElementById('A_Result').textContent = day[0];
            document.getElementById('B_Result').textContent = day[1];
            document.getElementById('C_Result').textContent = month[0];
            document.getElementById('D_Result').textContent = month[1];
            document.getElementById('E_Result').textContent = year[0];
            document.getElementById('F_Result').textContent = year[1];
            document.getElementById('G_Result').textContent = year[2];
            document.getElementById('H_Result').textContent = year[3];
            // Calculate Add up Day
            const I_ = sumDigits(day);
            document.getElementById('I_Result').textContent = I_;

            // Calculate Add up Month
            const J_ = sumDigits(month);
            document.getElementById('J_Result').textContent = J_;

            // Calculate Add up Year Parts

            const K_ = sumDigits(year.substring(0, 2)); // e.g., "19" or "20"
            // For display, we show the summed digit of each part
            const addUpYearPart1Result = K_;
            document.getElementById('K_Result').textContent = addUpYearPart1Result;

            const L_ = sumDigits(year.substring(2, 4)); // e.g., "82" or "25"
            const addUpYearPart2Result = L_;
            document.getElementById('L_Result').textContent = addUpYearPart2Result;


            // NEW CALCULATION: M_ = I_addUpDay + J_addUpMonth
            // First sum the numbers, then apply sumDigits to the result (converted to string)
            const M_ = sumDigits((I_ + J_).toString());
            document.getElementById('M_Result').textContent = M_;

            // NEW CALCULATION: N_ = K_yearPart1 + L_yearPart2
            // Sum the *numeric values* of the year parts, then apply sumDigits
            const N_ = sumDigits((parseInt(K_, 10) + parseInt(L_, 10)).toString());
            document.getElementById('N_Result').textContent = N_;

            const O_ = sumDigits( (M_ + N_) ).toString() ;
            document.getElementById('O_Result').textContent = O_;

            const P_ = sumDigits( (M_ + O_) ).toString() ;
            document.getElementById('P_Result').textContent = P_;

            const Q_ = sumDigits( (N_ + O_) ).toString() ;
            document.getElementById('Q_Result').textContent = Q_;

            const R_ = sumDigits( (Q_ + P_) ).toString() ;
            document.getElementById('R_Result').textContent = R_;

            const S_ = sumDigits( (J_ + M_) ).toString() ;
            document.getElementById('S_Result').textContent = S_;

            const T_ = sumDigits( (I_ + M_) ).toString() ;
            document.getElementById('T_Result').textContent = T_;

            const U_ = sumDigits( (T_ + S_) ).toString() ;
            document.getElementById('U_Result').textContent = U_;

            const V_ = sumDigits( (K_ + N_) ).toString() ;
            document.getElementById('V_Result').textContent = V_;

            const W_ = sumDigits( (L_ + N_) ).toString() ;
            document.getElementById('W_Result').textContent = W_;

            const X_ = sumDigits( (V_ + W_) ).toString() ;
            document.getElementById('X_Result').textContent = X_;

            const F1_ = I_ + " " + J_ + " " + M_;
            document.getElementById('F1_Result').textContent = F1_;

            const F2_ = addUpYearPart1Result + " " + addUpYearPart2Result + " " + N_;
            document.getElementById('F2_Result').textContent = F2_;
			
            const F3_ = M_ + " " + N_ + " " + O_;
            document.getElementById('F3_Result').textContent = F3_;

            const F4_ = M_ + " " + O_ + " " + P_;
            document.getElementById('F4_Result').textContent = F4_;
			
            const F5_ = N_ + " " + O_ + " " + Q_;
            document.getElementById('F5_Result').textContent = F5_;

            const F6_ = Q_ + " " + P_ + " " + R_;
            document.getElementById('F6_Result').textContent = F6_;

            const F7_ = I_ + " " + M_ + " " + T_;
            document.getElementById('F7_Result').textContent = F7_;

            const F8_ = J_ + " " + M_ + " " + S_;
            document.getElementById('F8_Result').textContent = F8_;

            const F9_ = T_ + " " + S_ + " " + U_;
            document.getElementById('F9_Result').textContent = F9_;

            const F10_ = L_ + " " + N_ + " " + W_;
            document.getElementById('F10_Result').textContent = F10_;

            const F11_ = K_ + " " + N_ + " " + V_;
            document.getElementById('F11_Result').textContent = F11_;

            const F12_ = W_ + " "  + V_ + " " +  X_;
            document.getElementById('F12_Result').textContent = F12_;


            const Y1 = sumDigits( (M_ + M_) ).toString() ;
            const Y2 = sumDigits( (N_ + N_) ).toString() ;
            const Y3 = sumDigits( (O_ + O_) ).toString() ;

            const F13_ = Y1 + " " + Y2 + " " + Y3;
            document.getElementById('F13_Result').textContent = F13_;


            // Draw Triangle

            drawTriangle(day);
        }

        function drawTriangle(textA) {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            // Clear previous drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Triangle dimensions
            const topY = 50;
            const bottomY = 250;
            const topLeftX = 50;
            const topRightX = 250;
            const apexX = 150; // Center X

            const triangleHeight = bottomY - topY; // 200 pixels
            const segmentHeight = triangleHeight / 3; // ~66.67 pixels per segment

            // Draw the main inverted triangle
            ctx.beginPath();
            ctx.moveTo(topLeftX, topY);       // Top-left point
            ctx.lineTo(topRightX, topY);      // Top-right point
            ctx.lineTo(apexX, bottomY);       // Bottom point (apex)
            ctx.closePath();
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = 'lightblue';
            ctx.fill();

            // Function to get the x-coordinates on the triangle's sides at a given y
            function getXCoordinatesAtY(y) {
                // Linear interpolation for X
                // For left side: from (topLeftX, topY) to (apexX, bottomY)
                const ratioFromTop = (y - topY) / triangleHeight;
                const currentLeftX = topLeftX + ratioFromTop * (apexX - topLeftX);

                // For right side: from (topRightX, topY) to (apexX, bottomY)
                const currentRightX = topRightX + ratioFromTop * (apexX - topRightX);

                return { left: currentLeftX, right: currentRightX };
            }

            // Draw the first horizontal line (dividing 1st and 2nd part)
            const line1Y = topY + segmentHeight;
            const line1Coords = getXCoordinatesAtY(line1Y);
            ctx.beginPath();
            ctx.moveTo(line1Coords.left, line1Y);
            ctx.lineTo(line1Coords.right, line1Y);
            ctx.strokeStyle = 'red'; // Different color for internal lines
            ctx.lineWidth = 1;
            ctx.stroke();

            // Draw the second horizontal line (dividing 2nd and 3rd part)
            const line2Y = topY + (2 * segmentHeight);
            const line2Coords = getXCoordinatesAtY(line2Y);
            ctx.beginPath();
            ctx.moveTo(line2Coords.left, line2Y);
            ctx.lineTo(line2Coords.right, line2Y);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 1;
            ctx.stroke();
			
			
            // --- Draw Text Inside Triangle ---
            ctx.fillStyle = 'black'; // Text color
            ctx.font = '24px Arial'; // Text font and size
            ctx.textAlign = 'center'; // Center text horizontally
            ctx.textBaseline = 'middle'; // Center text vertically
			// Position for M_ (Top segment)
            const A_TextY = topY + (segmentHeight / 2);
            ctx.fillText(textA, apexX, A_TextY);
			
        }
    </script>

</body>
</html>
